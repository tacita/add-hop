<!DOCTYPE html>

<html lang="en">
<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width"/>    

	<title>add block playground</title>

	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>

	<style type="text/css">

		.article { position: absolute; left: 200px; max-width: 800px; margin: 0 auto; }

		.add-container { width: 300px; height: 310px; } /* set all elements that need to be add-block container size to same size */
		#add-block { position: static; margin: 0 auto; }
		#add-block-placer { display: none; }

		/* tablet-ish and up for javascript enabled browsers */
		@media only screen and (min-width: 768px) {
			.js #add-block-placer { display: inline; float: right; margin-left: 15px; }
			.js #add-block { position: absolute; z-index: 1;}
		}

	</style>
	
</head>

<body>
	<div class="article">

		<div id="add-block-placer" class="add-container"><!-- For wider screen viewing experience this placeholder is given a height and width. Its position is then used for relocating add block. --></div>

		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vehicula lacus id tellus pulvinar vel sollicitudin ipsum luctus.</p>

		<p>Etiam consequat dapibus nibh, non vulputate nisl consequat non. Sed eget mauris non nunc sagittis vehicula ac vitae lacus. Aenean eu leo ut nisl consectetur pellentesque. Ut sed odio ante. Praesent ultricies lacinia risus nec eleifend. Maecenas et lacinia leo. Fusce dignissim tristique ipsum, ut cursus sem euismod vitae. Phasellus mauris odio, semper quis aliquam ac, tincidunt suscipit tortor. Praesent vestibulum porta orci at ultricies.</p>

		<blockquote>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nunc tempor pretium eros egestas posuere. Curabitur cursus tortor eget risus pretium non fermentum nulla molestie. Nulla facilisi. Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat molestie. Nulla facilisi. Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat.  Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat molestie. Nulla facilisi. Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat velit eget tellus dapibus ut tempus justo scelerisque. Aliquam sit amet ligula ac urna dapibus cursus ac in libero. Morbi felis nisi, pulvinar eu rhoncus vel, cursus in felis. Proin ligula nisi, dapibus et fermentum at, porta id lectus.</blockquote>

		<p>Cras porttitor, enim in gravida ullamcorper, velit risus rutrum dolor, non dignissim est massa eu augue. In elit ligula, pretium a lacinia quis, egestas quis sem. Vivamus ac consequat sapien. Sed convallis laoreet massa, eu faucibus ipsum venenatis id. Nulla facilisi. Pellentesque dapibus, elit nec varius eleifend, lectus metus lacinia arcu, eu porta augue velit egestas purus. Vivamus eget nunc vel justo porttitor scelerisque ut in nunc. Vestibulum ipsum urna, tincidunt vitae bibendum nec, tempor sed odio. Praesent ut purus sit amet purus euismod sollicitudin.</p>

		<!-- START: PBS 300x250 ad -->
		<div id="add-block" class="add-container" data-placeholder="add-block-placer">
	
			<h4>Support provided by:</h4>

			<!-- begin ad tag (tile=1) -->
			<script language="JavaScript" src="http://ad.doubleclick.net/adj/n6735.PBS/science_general_NOVA;tile=1;nova-topic=evolution;sz=300x250;ord=1?" type="text/javascript"></script>
			<noscript><a href="http://ad.doubleclick.net/adj/n6735.PBS/science_general_NOVA;tile=1;nova-topic=evolution;sz=300x250;ord=123456789?" target="_blank"><img src="http://ad.doubleclick.net/adj/n6735.PBS/science_general_NOVA;tile=1;nova-topic=evolution;sz=300x250;ord=123456789?" width="300" height="250" border="0" alt=""></a></noscript>
			
		</div>		
		<!-- END: PBS 300x250 ad -->
 
	</div>


	<script type="text/javascript">

		(function(ah){
			/*
				Purpose:
					Move where add-block is being displayed for different viewports. Uses a placeholder to absolutely position an add-block in certian viewports.
				CSS requirements for add-hop functionality:
					- add-block element needs data-placeholder attribute set to id of its target placeholder
					- set matching width and height on empty placeholder element and actual add-block
					- for default add-block display, style placeholder with: { display: none; }
					- for shifted add-block display (within @media rules), style placeholder with: { display: inline; ...
				Todo:
					- make add block id configurable
					- allow for multiple placeholders
					- allow for multiple add-blocks
					- throttle onresize event listener
			*/

			var win = ah.window,
				doc = ah.document,
				addBlockId = 'add-block',
				addBlock = doc.getElementById( addBlockId ),
	    		placeholderId = addBlock.getAttribute( 'data-placeholder' ),
	    		placeholder = doc.getElementById( placeholderId );

			
            win.addEventListener('load', function() {
				// indicate js support, if not already indicated
				if ((' ' + doc.body.className + ' ').indexOf(' js ') == -1) { doc.body.className+=' js'; }

				// trigger add hopping functionality on page load (& window resize)
				hopAddBlock( addBlockId );
		    }, false);

		    // trigger add hopping functionality on page resize
			win.onresize = function() { hopAddBlock( addBlockId ); }; // todo: throttle

			// If the placeholder is currently visible, match the add block's position to the placeholder's position.
			function hopAddBlock( addBlockId ) {

		        // bail if no placeholder is found
		        if (!placeholder) { 
		            addBlock.style.position = 'static';
		            return;
		        }

		    	var curStyle = (placeholder) ? getRenderedStyle( placeholder, 'display' ) : null,
		    		pTop,
		    		pLeft;

		    	if ( curStyle != 'none' && placeholder) {
		    		// get placeholder position
		    		pos = findPos( placeholder );
		    		pLeft = pos.left;
		    		pTop = pos.top;

		    		// move add-block there
		    		addBlock.style.top = pTop + 'px';
		    		addBlock.style.left = pLeft + 'px';

		    	} else if (typeof console == "object") {
	    			console.warn('There may be a problem with the data-placeholder attribute on the add block finding a match with an id of a placeholders. [add-hop]');
	    		}
    		}

			// Return position of the given object in relation to viewport. (Adapted from http://www.quirksmode.org/js/findpos.html)
			function findPos( elt ) {
				var curLeft = curTop = diffLeft = diffTop = 0,
					parentPos = '';

				if ( elt.offsetParent ) {
					do {
						curLeft += elt.offsetLeft;
						curTop += elt.offsetTop;

						// adjust for absolutely and relatively positioned elements
						parentPos = getRenderedStyle( elt, 'position');
						if( parentPos == 'absolute' || parentPos == 'relative') {
	                        diffTop += elt.offsetTop;
	                        diffLeft += elt.offsetLeft;
	                    }
					} while ( elt = elt.offsetParent );
				return {'left': curLeft - diffLeft, 'top': curTop - diffTop};
				}
			}

			// Return the value the given property is set to on the given element
			function getRenderedStyle( elt, prop ) {
				// modern js-friendly browsers
				if ( doc.defaultView && doc.defaultView.getComputedStyle ) {
					return doc.defaultView.getComputedStyle( elt, null )[prop];
				// oldschool/IE browsers
				} else if ( elt.currentStyle ) {
					return elt.currentStyle[prop];
				}
			}

		})( this );

	</script>
</body>
</html>
