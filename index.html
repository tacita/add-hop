<!DOCTYPE html>

<html lang="en">
<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width"/>    

	<title>add block playground</title>

	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>

	<style type="text/css">
		.article { max-width: 800px; margin: 0 auto; }

		.add-container { width: 300px; height: 310px; } /* set all elements that need to be add-block container size to same size */
		#add-block { position: static; margin: 0 auto; }
		#add-block-placer { display: none; }

		/* tablet-ish and up for javascript enabled browsers */
		@media only screen and (min-width: 768px) {
			.js #add-block-placer { display: inline; float: right; margin-left: 15px; }
			.js #add-block { position: absolute; z-index: 1;}
		}

	</style>
	
</head>

<body>

	<div class="article">

		<div id="add-block-placer" class="add-container"><!-- For wider screen viewing experience this placeholder is given a height and width. Its position is then used for relocating add block. --></div>

		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque vehicula lacus id tellus pulvinar vel sollicitudin ipsum luctus.</p>

		<p>Etiam consequat dapibus nibh, non vulputate nisl consequat non. Sed eget mauris non nunc sagittis vehicula ac vitae lacus. Aenean eu leo ut nisl consectetur pellentesque. Ut sed odio ante. Praesent ultricies lacinia risus nec eleifend. Maecenas et lacinia leo. Fusce dignissim tristique ipsum, ut cursus sem euismod vitae. Phasellus mauris odio, semper quis aliquam ac, tincidunt suscipit tortor. Praesent vestibulum porta orci at ultricies.</p>

		<blockquote>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nunc tempor pretium eros egestas posuere. Curabitur cursus tortor eget risus pretium non fermentum nulla molestie. Nulla facilisi. Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat molestie. Nulla facilisi. Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat.  Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat molestie. Nulla facilisi. Fusce et mauris vitae leo rhoncus placerat. Donec egestas ultricies lacinia. Nullam placerat velit eget tellus dapibus ut tempus justo scelerisque. Aliquam sit amet ligula ac urna dapibus cursus ac in libero. Morbi felis nisi, pulvinar eu rhoncus vel, cursus in felis. Proin ligula nisi, dapibus et fermentum at, porta id lectus.</blockquote>

		<p>Cras porttitor, enim in gravida ullamcorper, velit risus rutrum dolor, non dignissim est massa eu augue. In elit ligula, pretium a lacinia quis, egestas quis sem. Vivamus ac consequat sapien. Sed convallis laoreet massa, eu faucibus ipsum venenatis id. Nulla facilisi. Pellentesque dapibus, elit nec varius eleifend, lectus metus lacinia arcu, eu porta augue velit egestas purus. Vivamus eget nunc vel justo porttitor scelerisque ut in nunc. Vestibulum ipsum urna, tincidunt vitae bibendum nec, tempor sed odio. Praesent ut purus sit amet purus euismod sollicitudin.</p>

		<!-- START: PBS 300x250 ad -->
		<div id="add-block" class="add-container">
	
			<h4>Support provided by:</h4>

			<!-- begin ad tag (tile=1) -->
			<script language="JavaScript" src="http://ad.doubleclick.net/adj/n6735.PBS/science_general_NOVA;tile=1;nova-topic=evolution;sz=300x250;ord=1?" type="text/javascript"></script>
			<noscript><a href="http://ad.doubleclick.net/adj/n6735.PBS/science_general_NOVA;tile=1;nova-topic=evolution;sz=300x250;ord=123456789?" target="_blank"><img src="http://ad.doubleclick.net/adj/n6735.PBS/science_general_NOVA;tile=1;nova-topic=evolution;sz=300x250;ord=123456789?" width="300" height="250" border="0" alt=""></a></noscript>
			
		</div>		
		<!-- END: PBS 300x250 ad -->
 
	</div>


	<script type="text/javascript">

		window.onload = function() { 
			document.body.className+=' js'; // indicate js support
			hopAddBlock();
		};
		window.onresize = function() { hopAddBlock(); }; // todo: throttle


		/*
			findPos: Return position (top and left) of the given object in relation to the top left corner of the viewport. (Adapted from http://www.quirksmode.org/js/findpos.html)
			arguments:
				elt: a dom element

		*/
		function findPos(elt) {
			var curleft = curtop = 0;
			if (elt.offsetParent) {
				do {
					curleft += elt.offsetLeft;
					curtop += elt.offsetTop;
				} while (elt = elt.offsetParent);

			return {'left': curleft, 'top': curtop};
			}
		}
		

		/*
			getRenderedStyle: Return the value the given property is set to on the given element
			arguments: 
				elt: a dom element
				property: a string of the css property name to retrieve
		*/
		function getRenderedStyle(elt, property) {

			// modern js friendly browsers
			if (document.defaultView && document.defaultView.getComputedStyle) {
				return document.defaultView.getComputedStyle(elt, null)[property];

			// oldschool/IE browsers
			} else if (elt.currentStyle) {
				return elt.currentStyle[property];

			}
		}


		/* 
			hopAddBlock: If the placeholder is currently visible and taking up space (via styling within @media query), match the add block's position to the placeholder's position.

			CSS requirements: 
				- set matching width and height on empty placeholder element and add-block container. ex: .add-container { width: 300px; height: 310px; }
				- for default add-block position, style placeholder with: { display: none; }
				- for shifted add-block position, style placeholder with: { display: inline; ...				
		*/
		function hopAddBlock() {

	    	var placeholder = document.getElementById('add-block-placer'),
	    		addBlock = document.getElementById('add-block'),
	    		curStyle = getRenderedStyle(placeholder, 'display'),
	    		pTop,
	    		pLeft;

	    	// if the placeholder is being rendered, move the addblock to where the placeholder is
	    	if (curStyle != 'none') {
	    		// get placeholder position
	    		curPos = findPos(placeholder);
	    		pLeft = curPos.left;
	    		pTop = curPos.top;

	    		// move add-block there
	    		addBlock.style.top = pTop + 'px';
	    		addBlock.style.left = pLeft + 'px';
	    	}

		}

	</script>
</body>
</html>
